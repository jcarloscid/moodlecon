# Moodle Connector for PrestaShop
Allows to enrol customers into your Moodle School's courses, after buying the enrolment in PrestaShop

**Requires PrestaShop 1.7+**

## Features

* Allows to connect to a single Moodle instance.
* Allows automatic enrolment (enrol when the order reach the _'paid'_ status).
* Allows manual enrolment (enrol by clicking on a button on the order admin panel).
* Notify the customer of the courses entitled by his/her order on the order confirmation page.
* Allow to send e-mail notifications to the customer with the enrolments performed.
* Allow to link a course to a particular product combination, as well to link any combination to the same course.
* Allows to set the role (student, teacher, ...) of the customer on the enrolment.
* Allows to specify the enrolment duration.
* Users created on Moodle can have either a default password (set by the module) or a temporary password generated by Moodle.

## Install and configure

Install as any other module on PrestaShop using the file `moodlecon.zip`.

Click on **Configure** after installing the module. Read the explanations on the admin panel to understand how to configure the module.

At the minimum you need to configure:
* `Moodle WS End Point`: URL to access your Moodle instance web service via REST protocol (eg. https://moodle.org/webservice/rest/server.php).
* `Moodle WS Token`: Security token to access Moodle via the Web Service (eg. 0123456789abcdef0123456789abcdef).
* Activate either **Automatic Enrolment** or **Manual Enrolment** (otherwise this module does nothing).

## Configure your Moodle instance

The following Moodle plugin is required: `local_wsgetroles` [Get the plugin](https://moodle.org/plugins/local_wsgetroles)

The module uses Moodle's web service in order to communicate with your Moodle instance. Only REST protocol is supported. You will need to enable this service and create one access token for the module.

The following actions needs to be authorized for the service:
* `core_webservice_get_site_info`
* `core_course_get_courses`
* `core_user_get_users_by_field`
* `core_user_create_users`
* `core_role_assign_roles`
* `enrol_manual_enrol_users`
* `local_wsgetroles_get_roles` (from plugin `local_wsgetroles`)

For a step-by-step guide to configure your moodle instance, please read [this article](https://fishandbits.es/moodle-prestashop-integracion/#habilitar-servicio-web) 

## Translations

**OAuth 2.0 Single SignOn Client** is provided with translations for the following languages:

* Spanish from Spain (`es_ES`)

## Emails' subjects translations

As of _PrestaShop 1.7.7.1_ custom emails' subjects cannot be translated by means of the admin tools. However, translation can be performed by directly modifying some source files inside your theme's folder structure.

If you are familiar with code customizations, please see instructions and sample code on `/translations/es-lang.php`.

## License

This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307,USA.

The "GNU General Public License" (GPL) is available at http://www.gnu.org/licenses/old-licenses/gpl-2.0.html

## More info

Please read [this article](https://fishandbits.es/moodle-prestashop-integracion/#habilitar-servicio-web) for more details about this module (language: Spanish).
